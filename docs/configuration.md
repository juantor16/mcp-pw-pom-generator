# Configuration Guide

This guide explains how to set up and configure the MCP POM Generator for your specific needs.

## Playwright Configuration

### 1. Basic Setup (`playwright.config.ts`)

Create or modify your `playwright.config.ts` file:

```typescript
import { defineConfig, devices } from '@playwright/test';
import path from 'path';

// Define the path for session storage
const storageStatePath = 'storageState.json';

export default defineConfig({
  timeout: 5 * 60 * 1000, // 5 minutes timeout
  globalSetup: require.resolve('./src/global.setup.ts'),

  projects: [
    {
      name: 'mcp-crawler-setup',
      testMatch: /global\.setup\.ts/,
    },
    {
      name: 'mcp-crawler-main',
      use: {
        storageState: storageStatePath,
        ...devices['Desktop Chrome'],
        headless: false,
        launchOptions: { slowMo: 50 },
        viewport: null,
      },
    },
  ],
});
```

## Authentication Configuration

### 1. Global Setup (`src/global.setup.ts`)

Configure your authentication settings in `src/global.setup.ts`:

```typescript
// ---- Specific Login Configuration ----
const username = process.env.BIO_USERNAME || 'YOUR_DEFAULT_USERNAME';
const password = process.env.BIO_PASSWORD || 'YOUR_DEFAULT_PASSWORD';
const loginUrl = 'YOUR_LOGIN_URL';
const usernameSelector = 'YOUR_USERNAME_SELECTOR';
const passwordSelector = 'YOUR_PASSWORD_SELECTOR';
const submitButtonSelector = 'YOUR_SUBMIT_BUTTON_SELECTOR';
const welcomeMessage = 'YOUR_WELCOME_MESSAGE_SELECTOR';
```

### 2. Environment Variables

Create a `.env` file in your project root:

```bash
BIO_USERNAME=your_username
BIO_PASSWORD=your_password
```

> **Important**: Add `.env` to your `.gitignore` file to prevent committing sensitive credentials.

## Required Configurations

### 1. Login Page Configuration

You need to configure the following in `global.setup.ts`:

1. **Login URL**
   - Set the `loginUrl` variable to your application's login page URL
   - Example: `const loginUrl = 'https://your-app.com/login';`

2. **Element Selectors**
   - Username field selector
   - Password field selector
   - Submit button selector
   - Welcome message selector (for login verification)

3. **Credentials**
   - Use environment variables for secure credential storage
   - Set fallback values for development/testing

### 2. Session Management

1. **Storage State**
   - The system uses `storageState.json` for session persistence
   - This file is automatically generated after successful login
   - Add `storageState.json` to `.gitignore` for security

2. **Session Expiration**
   - Sessions may expire over time
   - The system will automatically detect expired sessions
   - Manual login may be required periodically

## Optional Configurations

### 1. Browser Settings

In `playwright.config.ts`, you can customize:

```typescript
{
  headless: false, // Set to true for headless operation
  launchOptions: { 
    slowMo: 50, // Adjust for slower/faster operation
  },
  viewport: null, // Set specific viewport if needed
}
```

### 2. Timeout Settings

```typescript
{
  timeout: 5 * 60 * 1000, // Adjust global timeout
  navigationTimeout: 30000, // Adjust navigation timeout
}
```

## Security Considerations

1. **Credentials**
   - Never hardcode credentials in the code
   - Always use environment variables
   - Keep `.env` file secure and private

2. **Session Storage**
   - `storageState.json` contains sensitive session data
   - Keep it secure and never commit to version control
   - Regenerate if compromised

3. **Environment Variables**
   - Use different credentials for different environments
   - Consider using a secrets management system for production

## Best Practices

1. **Configuration Management**
   - Keep configurations in version control
   - Use environment-specific configuration files
   - Document all configuration options

2. **Authentication Setup**
   - Test login configuration before running crawls
   - Verify selectors are correct and stable
   - Handle session expiration gracefully

3. **Error Handling**
   - Configure appropriate timeouts
   - Set up proper error logging
   - Implement retry mechanisms for failed logins

## Troubleshooting

### Common Issues

1. **Login Failures**
   - Verify selectors are correct
   - Check network connectivity
   - Ensure credentials are valid

2. **Session Issues**
   - Clear `storageState.json` if corrupted
   - Run global setup again
   - Check for session expiration

3. **Configuration Errors**
   - Verify all required configurations are set
   - Check environment variables are loaded
   - Ensure file paths are correct

### Debugging Tips

1. **Enable Verbose Logging**
   - Set `headless: false` to see browser actions
   - Add console logs in `global.setup.ts`
   - Monitor network requests

2. **Selector Verification**
   - Use browser dev tools to verify selectors
   - Test selectors in isolation
   - Consider using more stable selectors

3. **Session Management**
   - Monitor session expiration
   - Clear session state when needed
   - Test manual login fallback 